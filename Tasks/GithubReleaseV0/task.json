{
    "id": "7B5A6198-ADF8-4B16-9939-7ADDF85708B2",
    "name": "GithubRelease",
    "friendlyName": "Github Release",
    "description": "Create, edit or discard the github release",
    "helpMarkDown": "[More Information](https://github.com/Microsoft/azure-pipelines-tasks/blob/master/Tasks/GithubReleaseV0/README.md)",
    "category": "Utility",
    "visibility": [
        "Build",
        "Release"
    ],
    "author": "Microsoft Corporation",
    "preview": true,
    "version": {
        "Major": 0,
        "Minor": 0,
        "Patch": 0
    },
    "demands": [],
    "minimumAgentVersion": "2.0.0",
    "inputs": [
        {
            "name": "githubEndpoint",
            "type": "connectedService:github",
            "label": "GitHub Connection",
            "defaultValue": "",
            "required": true,
            "helpMarkDown": "Select the service endpoint for your GitHub connection. Click the 'Manage' link to create a new service endpoint. To know more about service connections [click here.](https://docs.microsoft.com/en-us/azure/devops/pipelines/library/service-endpoints?view=vsts#sep-github)"
        },
        {
            "name": "repositoryName",
            "type": "pickList",
            "label": "Repository",
            "defaultValue": "",
            "required": true,
            "helpMarkDown": "Select the name of github repository where github releases will be created.",
            "properties": {
                "DisableManageLink": "True"
            }
        },
        {
            "name": "action",
            "type": "pickList",
            "label": "Action",
            "defaultValue": "Create",
            "required": true,
            "helpMarkDown": "Select the type of release operation you want perform. This task can create, edit or discard a github release.",
            "options": {
                "Create": "Create",
                "Edit": "Edit",
                "Discard": "Discard"
            }
        },
        {
            "name": "target",
            "type": "string",
            "label": "Target",
            "defaultValue": "$(Build.SourceVersion)",
            "required": true,
            "visibleRule": "action = Create || action = Edit",
            "helpMarkDown": "This is the commit SHA for which the github release will be created. E.g. 48b11d8d6e92a22e3e9563a3f643699c16fd6e27. You can also use variables here."
        },
        {
            "name": "tagSelection",
            "type": "radio",
            "label": "Tag type",
            "required": true,
            "defaultValue": "auto",
            "visibleRule": "action = Create",
            "helpMarkDown": "Configure the tag to be used for release creation. 'Git tag' option automatically takes the tag which is associated with this commit. Use 'User specified tag' option in case you want to manually provide a tag.",
            "options": {
                "auto": "Git tag",
                "manual": "User specified tag"
            }
        },
        {
            "name": "tag",
            "type": "string",
            "label": "Tag",
            "defaultValue": "",
            "required": true,
            "visibleRule": "action = Edit || action = Discard || tagSelection = manual",
            "helpMarkDown": "Specify the tag for which you want to create, edit or discard a release. You can also use variables here. E.g. $(tagName)."
        },
        {
            "name": "releaseTitle",
            "type": "string",
            "label": "Release title",
            "defaultValue": "",
            "required": false,
            "visibleRule": "action = Create || action = Edit",
            "helpMarkDown": "Specify the title of the github release. If left empty, the tag will be used as release title."
        },
        {
            "name": "releaseNotesSelection",
            "type": "radio",
            "label": "Release notes source",
            "required": false,
            "defaultValue": "file",
            "visibleRule": "action = Create || action = Edit",
            "helpMarkDown": "Specify the description of github release. Use 'Release notes file' option if you wish that the contents of a file to be copied as github release notes. Use 'Inline release notes' option if you want to manually enter the release notes.",
            "options": {
                "file": "Release notes file",
                "input": "Inline release notes"
            }
        },
        {
            "name": "releaseNotesFile",
            "type": "filePath",
            "label": "Release notes file path",
            "required": false,
            "helpMarkDown": "Select the file which contains the release notes.",
            "visibleRule": "releaseNotesSelection = file"
        },
        {
            "name": "releaseNotesInput",
            "type": "multiLine",
            "label": "Release notes",
            "required": false,
            "helpMarkDown": "Type your release notes here. Accepts markdown.",
            "visibleRule": "releaseNotesSelection = input",
            "properties": {
                "resizable": "true",
                "rows": "4",
                "maxLength": "5000"
            }
        },
        {
            "name": "githubReleaseAsset",
            "type": "multiLine",
            "label": "Assets",
            "defaultValue": "$(Build.ArtifactStagingDirectory)/*",
            "required": false,
            "visibleRule": "action = Create || action = Edit",
            "helpMarkDown": "Specify the files to be uploaded as assets for the release. You can use wildcard characters to specify set of files. E.g. $(Build.ArtifactStagingDirectory)/*.zip. You can also specify multiple patterns- one per line. By default, all files in $(Build.ArtifactStagingDirectory) directory will be uploaded.",
            "properties": {
                "resizable": "true",
                "rows": "4"
            }
        },
        {
            "name": "assetUploadMode",
            "type": "radio",
            "label": "Asset upload mode",
            "required": false,
            "defaultValue": "delete",
            "visibleRule": "action = Edit",
            "helpMarkDown": "Use 'Delete existing assets' option, if you want to first delete any existing assets in the release and then upload all the assets. Use 'Replace existing assets' option, if you want to replace any assets that have the same name.",
            "options": {
                "delete": "Delete exisiting assets",
                "replace": "Replace existing assets"
            }
        },
        {
            "name": "isDraft",
            "type": "boolean",
            "label": "Draft release",
            "defaultValue": "false",
            "required": false,
            "helpMarkDown": "This option specifies if the release has to be saved as a draft release. If unchecked, the release will be published.",
            "visibleRule": "action = Create || action = Edit"
        },
        {
            "name": "isPrerelease",
            "type": "boolean",
            "label": "Pre release",
            "defaultValue": "false",
            "required": false,
            "visibleRule": "action = Create || action = Edit",
            "helpMarkDown": "This option specifies if the release has to be marked as a pre-release."
        },
        {
            "name": "changeLog",
            "type": "boolean",
            "label": "Add changelog",
            "defaultValue": "true",
            "required": false,
            "visibleRule": "action = Create || action = Edit",
            "helpMarkDown": "Using this option you can generate and append list of changes to release notes. The list of changes(commits and issues) between this and last published release will be generated and appended to release notes."
        }
    ],
    "sourceDefinitions": [
        {
            "target": "repositoryName",
            "endpoint": "/$(system.teamProject)/_apis/sourceProviders/GitHub/repositories?serviceEndpointId=$(githubEndpoint)",
            "selector": "jsonpath:$.repositories[*].id",
            "keySelector": "jsonpath:$.repositories[*].id",
            "authKey": "tfs:teamfoundation"
        }
    ],
    "instanceNameFormat": "$(action) GitHub Release",
    "execution": {
        "Node": {
            "target": "main.js"
        }
    },
    "messages": {
        "CreatingRelease": "Creating release for tag: %s",
        "CreateReleaseError": "An error occurred while creating release.",
        "CreateReleaseSuccess": "Release created successfully at %s",
        "DiscardingRelease": "Discarding release for tag: %s",
        "DiscardReleaseError": "An error occurred while discarding release.",
        "NoReleaseFoundCreateRelease": "No existing release found to edit. Creating one with the tag: %s",
        "DiscardReleaseSuccess": "Release discarded successfully",
        "EditingRelease": "Editing release with tag: %s",
        "EditReleaseError": "An error occurred while editing release.",
        "EditReleaseSuccess": "Release edited successfully",
        "GetReleasesError": "An error occurred while fetching releases",
        "GetTagsError": "An error occurred while fetching tags",
        "GetBranchError": "An error occurred while fetching branch",
        "MissingAssetError": "File not found: %s",
        "NoReleaseFoundToDiscard": "No release found for tag: %s. Discarding release failed.",
        "MultipleReleasesFoundError": "More than 1 release found for tag: %s.",
        "DuplicateAssetFound": "Duplicate asset found: %s",
        "SkipDuplicateAssetFound": "Duplicate asset found: %s. Skipping...",
        "DeletingDuplicateAsset": "Deleting duplicate asset: %s",
        "MultipleTagFound": "More than 1 tag found for given commit: %s",
        "DuplicateAssetDeletedSuccessfully": "Duplicate asset deleted successfully: %s\n Uploading the asset again",
        "AssetDeletedSuccessfully": "Asset %s deleted successfully",
        "NoTagFound": "No tag found for provided target: %s. Skipping further steps",
        "CommitDiffBehind": "Cannot compute the commit difference as the provided target commit is older than the commit of last published release.",
        "CommitDiffEqual": "No changes found. The provided target commit is same as the commit of last published release.",
        "ErrorDeletingDuplicateAsset": "An error occurred while deleting duplicate asset: %s",
        "ErrorDeletingAsset": "An error occurred while deleting asset: %s",
        "UploadingAsset": "Uploading asset: %s",
        "UploadingAssets": "Uploading assets...",
        "UploadAssetError": "An error occurred while uploading asset: %s",
        "UploadAssetSuccess": "Uploaded asset: %s",
        "DeleteAllAsset": "Deleting assets...",
        "DeletingAsset": "Deleting asset: %s",
        "NoAssetFoundToDelete": "No assets found to delete.",
        "NoAssetFoundToUpload": "No assets found to upload.",
        "ReleaseNotesFileIsDirectoryError": "Release notes file: %s is a directory and not a file. Release notes will be set as empty.",
        "AssetIsDirectoryError": "Asset is a directory and not a file. Skipping uploading directory: %s",
        "GetLatestReleaseError": "Error fetching latest release",
        "GetCommitsListError": "Error fetching list of commits",
        "GetReposError": "Error fetching repos",
        "GetCommitsByShaError": "Error fetching the initial commit",
        "ReleaseAlreadyExists": "Failed to create release. Release already exists for tag: %s",
        "ComputingChangeLog": "Computing changes made in this release..."
    }
}