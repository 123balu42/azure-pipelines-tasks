{
    "id": "1B4FDD02-B979-480D-9A7E-0B7AF7FE471F",
    "name": "evaluateArtifactPolicies",
    "friendlyName": "Evaluate artifact policies",
    "description": "Ensure artifacts adhere to custom policies (container images only)",
    "author": "Microsoft Corporation",
    "helpUrl": "https://docs.microsoft.com/azure/devops/pipelines/tasks/utility/work-item-query",
    "helpMarkDown": "[Learn more about this task](https://go.microsoft.com/fwlink/?linkid=870238)",
    "category": "Utility",
    "visibility": [
        "Build"
    ],
    "runsOn": [
        "Server",
        "ServerGate"
    ],
    "version": {
        "Major": 0,
        "Minor": 167,
        "Patch": 0
    },
    "instanceNameFormat": "Evaluate artifact policies",
    "inputs": [
        {
            "name": "policyContent",
            "type": "multiline",
            "label": "Policy definitions",
            "defaultValue": "",
            "required": "true",
            "helpMarkDown": "Define policies based on rego format ([See examples](https://aka.ms/AA6e0a2))"
        }
    ],
    "execution": {
        "HttpRequest": {
            "Execute": {
                "EndpointId": "",
                "EndpointUrl": "$(system.teamFoundationCollectionUri)$(system.teamProjectId)/_apis/deployment/evaluateArtifactPolicies?api-version=6.0-preview",
                "Method": "POST",
                "Body": "{\r\n   \"hubName\": \"$(system.hostType)\",\r\n   \"planId\": \"$(system.planId)\",\r\n   \"policyContent\": \"$(policyContent)\",\r\n   \"pipelineRunId\": \"$(build.buildId)\",\r\n   \"policyDisplayName\": \"$(system.taskDisplayName)\",\r\n    \"taskInstanceId\": \"$(system.taskInstanceId)\",\r\n    \"variables\": {\r\n         \"system.debug\": \"$(system.debug)\"\r\n     }\r\n}",
                "Headers": "{\n\"Content-Type\":\"application/json\"\n, \"Authorization\":\"Bearer $(system.accesstoken)\"\n}",
                "WaitForCompletion": "false",
                "Expression": "eq(root, 'succeeded')"
            }
        }
    }
}